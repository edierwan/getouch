# Staging Database — reuses the existing postgres-ssd container
# from docker-compose.db-staging.yml in the parent directory.
#
# postgres-ssd is already running on `getouch_data` network.
# Staging apps connect to it at postgres-ssd:5432.
#
# If you need a dedicated staging pgAdmin:
#   cd /opt/getouch/compose/staging
#   docker compose -p getouch-stg -f docker-compose.db.yml up -d

services:
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: pgadmin-stg
    restart: unless-stopped
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL:-admin@getouch.co}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD:-admin}
      PGADMIN_LISTEN_PORT: 5050
      PGADMIN_CONFIG_AUTHENTICATION_SOURCES: "['webserver', 'internal']"
      PGADMIN_CONFIG_WEBSERVER_AUTO_CREATE_USER: "True"
      PGADMIN_CONFIG_WEBSERVER_REMOTE_USER: "'X-Forwarded-User'"
      PGADMIN_CONFIG_MASTER_PASSWORD_REQUIRED: "False"
      PGADMIN_CONFIG_SERVER_MODE: "True"
    expose:
      - "5050"
    networks:
      - getouch_data
      - getouch_app
    depends_on:
      - postgres-ssd

  # Reference only — postgres-ssd is defined in ../docker-compose.db-staging.yml
  postgres-ssd:
    image: postgres:16-alpine
    container_name: postgres-ssd
    profiles:
      - never   # Never started from here; just a reference for depends_on
    networks:
      - getouch_data

networks:
  getouch_data:
    external: true
  getouch_app:
    external: true
