# Umami Web Analytics — https://analytics.getouch.co
# Database: postgres-ssd (SATA SSD at /data) — must already be running
#
# Usage:
#   cd /opt/getouch/compose
#   docker compose -f docker-compose.analytics.yml up -d
#
# Requires: postgres-ssd container running on getouch_data network

services:
  umami:
    image: ghcr.io/umami-software/umami:postgresql-latest
    container_name: umami
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://postgres:Turun%40202020@postgres-ssd:5432/analytics.getouch.co
      APP_SECRET: ${UMAMI_APP_SECRET:-getouch-umami-secret-2026}
      TRACKER_SCRIPT_NAME: getscript
      COLLECT_API_ENDPOINT: /api/collect
      TZ: Asia/Kuala_Lumpur
    dns:
      - 127.0.0.11
    networks:
      - getouch_app
      - getouch_data
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://0.0.0.0:3000/api/heartbeat"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 30s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

networks:
  getouch_app:
    external: true
  getouch_data:
    external: true
